---
title: "Changes in the population of Trnava based on natural balance"
author: 
  - Erik Matovič
  - Simon Kokavec
date: November 2021
output: html_document
---

## Import libraries and read dataset

```{r}
# import library tidyverse for pipelines and read dataset
library(tidyverse)                
data <- read_csv("../data/dataset.csv")
```

## Average distance  
Výpočet piemernej vzdialenosti podľa svetovej strany a počet miest

```{r}
average_distance = data %>%
  select(`Vzdialenosť od Trnavy(km)`, `Svetová strana od Trnavy`) %>%
  group_by(`Svetová strana od Trnavy`) %>%
  summarise(priemerna_vzdialenost=mean(strtoi(`Vzdialenosť od Trnavy(km)`)),
            pocet_obci=n())
average_distance
```

## Natural balance in all years
Zistenie narodených, zomretých a prirodzený prírastok obyvateľstva za cele obdobie.  
Natural balance - the difference between the number of births and the number of deaths recorded over a period

```{r}
natural_balance_all = data %>%
  select(1:57, `Svetová strana od Trnavy`) %>%
  mutate(spolu_narodených=rowSums(across(2:29)),
         spolu_zomretých=rowSums(across(30:57)),
         spolu_prirodzeny_prirastok=spolu_narodených-spolu_zomretých
         )%>%
  select(1, 58, 59, 60, 61)
natural_balance_all
```

## Natural decrease in all years
Zistenie prirodzeného úbytku obcií za sledované obdobie - iba tie obce, ktoré "vymierajú"

```{r}
natural_decrease_all = natural_balance_all %>%
  filter(spolu_prirodzeny_prirastok < 0)
natural_decrease_all
```

## Number of natural decrease municipalities based on cardinal directions 
Má vzdialenosť od trnavy niečo spoločné s vymieraním obcí ?

```{r}
dying_muni_total = natural_decrease_all %>%
  group_by(`Svetová strana od Trnavy`) %>%
  summarise(dying_municipalities=n())
dying_muni_total
```

## ?? 

```{r}
merge(natural_decrease_all,dying_muni_total, by=1)
```

## Total increase of population in all years
Zistenie nárastu populácie aj s migračným saldom a prirodzeným prírastkom.

```{r}
total_increase_all = data %>%
  select(1,167:193, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`) %>%
  mutate(increase=rowSums(across(2:26))) %>%
  select(1, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`, `increase`) %>%
  group_by(`Svetová strana od Trnavy`) %>%
  summarise(total_increase_all = mean(`increase`))
total_increase_all
```

## Plot total increase of population in all years based on directions

```{r}
total_increase_all=total_increase_all[-4,]
barplot(total_increase_all[["total_increase_all"]],ylim=c(0,500), names.arg=total_increase_all[["Svetová strana od Trnavy"]])
```

## Má svetová strana od Trnavy niečo s vymieraním obcií a celkovým prírastkom?

```{r}
merge(total_increase_all, dying_muni_total, by=1)
```

## ??

```{r}
data %>%
  select(1,167:193, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`) %>%
  mutate(nárast=rowSums(across(2:26))) %>%
  select(1, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`, `nárast`) %>%
  group_by(`Svetová strana od Trnavy`) %>%
  filter(`Svetová strana od Trnavy` == "Z") 
```

## ??

```{r}
data %>%
  select(1,167:193, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`) %>%
  mutate(nárast=rowSums(across(2:26))) %>%
  select(1, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`, `nárast`) %>%
  group_by(`Svetová strana od Trnavy`) %>%
  filter(`Svetová strana od Trnavy` == "V") 
```

## ?? 

```{r}
temporary=data[-1,"Vzdialenosť od Trnavy(km)"]
quantile_values=quantile(strtoi(temporary[["Vzdialenosť od Trnavy(km)"]]))
quantile_values[5]

data %>%
  select(1,167:193, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`) %>%
  mutate(nárast=rowSums(across(2:26))) %>%
  select(1, `Vzdialenosť od Trnavy(km)`,`Svetová strana od Trnavy`, `nárast`) %>%
  group_by(`Svetová strana od Trnavy`) %>%
  filter(`Vzdialenosť od Trnavy(km)`!="x") %>%
  mutate(quantile=(ifelse(strtoi(`Vzdialenosť od Trnavy(km)`) <= quantile_values[2] , 1,
                   ifelse(strtoi(`Vzdialenosť od Trnavy(km)`) > quantile_values[2] & strtoi(`Vzdialenosť od Trnavy(km)`) <= quantile_values[3],2,
                          ifelse(strtoi(`Vzdialenosť od Trnavy(km)`)>quantile_values[3] & strtoi(`Vzdialenosť od Trnavy(km)`) < quantile_values[4],3,4)))))
 
```

